# RAGçŸ¥è¯†é—®ç­”ç³»ç»Ÿ - åç«¯éƒ¨ç½²å’Œå¯åŠ¨æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-10-17  
> **é€‚ç”¨ç¯å¢ƒ**: å¼€å‘/ç”Ÿäº§

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#1-ç¯å¢ƒå‡†å¤‡)
2. [å¼€å‘ç¯å¢ƒå¯åŠ¨](#2-å¼€å‘ç¯å¢ƒå¯åŠ¨)
3. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#3-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
4. [æ•°æ®åº“åˆå§‹åŒ–æµç¨‹](#4-æ•°æ®åº“åˆå§‹åŒ–æµç¨‹)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#5-å¸¸è§é—®é¢˜æ’æŸ¥)
6. [å¯åŠ¨è„šæœ¬](#6-å¯åŠ¨è„šæœ¬)

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 ç³»ç»Ÿè¦æ±‚

**ç¡¬ä»¶è¦æ±‚**:
- CPU: 2æ ¸å¿ƒä»¥ä¸Š
- å†…å­˜: 4GBä»¥ä¸Šï¼ˆæ¨è8GBï¼‰
- ç£ç›˜: 10GBå¯ç”¨ç©ºé—´
- ç½‘ç»œ: ç¨³å®šçš„ç½‘ç»œè¿æ¥

**è½¯ä»¶è¦æ±‚**:
- æ“ä½œç³»ç»Ÿ: Linux/macOS/Windows
- Python: 3.8+
- MySQL: 5.7+ æˆ– MariaDB 10.2+
- Git: ç”¨äºä»£ç ç®¡ç†

### 1.2 å®‰è£…Pythonç¯å¢ƒ

**Linux/macOS**:

```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# å®‰è£…pip
sudo apt-get install python3-pip  # Ubuntu/Debian
sudo yum install python3-pip      # CentOS/RHEL

# å®‰è£…è™šæ‹Ÿç¯å¢ƒå·¥å…·
pip3 install virtualenv
```

**Windows**:

1. ä¸‹è½½Pythonå®‰è£…åŒ…ï¼šhttps://www.python.org/downloads/
2. å®‰è£…æ—¶å‹¾é€‰"Add Python to PATH"
3. æ‰“å¼€å‘½ä»¤æç¤ºç¬¦éªŒè¯ï¼š`python --version`

### 1.3 å®‰è£…MySQL

**Linux**:

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install mysql-server

# CentOS/RHEL
sudo yum install mysql-server

# å¯åŠ¨MySQL
sudo systemctl start mysql
sudo systemctl enable mysql
```

**Windows**:

1. ä¸‹è½½MySQLå®‰è£…åŒ…ï¼šhttps://dev.mysql.com/downloads/installer/
2. è¿è¡Œå®‰è£…å‘å¯¼
3. è®¾ç½®rootå¯†ç 
4. å¯åŠ¨MySQLæœåŠ¡

**macOS**:

```bash
# ä½¿ç”¨Homebrew
brew install mysql
brew services start mysql
```

---

## 2. å¼€å‘ç¯å¢ƒå¯åŠ¨

### 2.1 å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd ZhongMeiRagProject/backEnd
```

### 2.2 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

**Linux/macOS**:

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate
```

**Windows**:

```powershell
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate
```

### 2.3 å®‰è£…ä¾èµ–

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
pip install -r requirements.txt
```

### 2.4 é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘.envæ–‡ä»¶
vi .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

**å¿…é¡»é…ç½®çš„é¡¹**:

```ini
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=123456
DB_NAME=rag_knowledge_base

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼ï¼‰
JWT_SECRET_KEY=your-secret-key-change-in-production
```

### 2.5 åˆå§‹åŒ–æ•°æ®åº“

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨Pythonè„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
python scripts/init_db.py
```

æŒ‰æç¤ºè¾“å…¥ `yes` ç¡®è®¤åˆå§‹åŒ–ã€‚

**æ–¹æ³•äºŒï¼šä½¿ç”¨SQLè„šæœ¬**

```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS rag_knowledge_base CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# å¯¼å…¥è¡¨ç»“æ„å’Œåˆå§‹æ•°æ®
mysql -u root -p rag_knowledge_base < scripts/create_db.sql
```

### 2.6 å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# æ–¹æ³•1: ç›´æ¥è¿è¡Œ
python app.py

# æ–¹æ³•2: ä½¿ç”¨Flaskå‘½ä»¤
export FLASK_APP=app.py
export FLASK_ENV=development
flask run --host=0.0.0.0 --port=8000

# Windows PowerShell
$env:FLASK_APP="app.py"
$env:FLASK_ENV="development"
flask run --host=0.0.0.0 --port=8000
```

### 2.7 éªŒè¯å¯åŠ¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **APIæµ‹è¯•**: ä½¿ç”¨Postmanå¯¼å…¥æ¥å£æ–‡æ¡£

```bash
# å‘½ä»¤è¡Œæµ‹è¯•
curl http://localhost:8000/health
```

é¢„æœŸå“åº”ï¼š

```json
{
  "status": "healthy",
  "service": "RAG Knowledge Base API",
  "version": "1.0.0"
}
```

---

## 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 3.1 æœåŠ¡å™¨å‡†å¤‡

**1. æ›´æ–°ç³»ç»Ÿ**

```bash
sudo apt-get update
sudo apt-get upgrade -y
```

**2. å®‰è£…å¿…è¦è½¯ä»¶**

```bash
sudo apt-get install -y python3 python3-pip mysql-server nginx supervisor
```

**3. åˆ›å»ºéƒ¨ç½²ç”¨æˆ·**

```bash
sudo useradd -m -s /bin/bash ragapp
sudo usermod -aG sudo ragapp
```

### 3.2 éƒ¨ç½²ä»£ç 

```bash
# åˆ‡æ¢åˆ°éƒ¨ç½²ç”¨æˆ·
su - ragapp

# å…‹éš†ä»£ç 
git clone <repository-url> /home/ragapp/rag-backend
cd /home/ragapp/rag-backend/backEnd

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install gunicorn
```

### 3.3 é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º.envæ–‡ä»¶
vi .env
```

```ini
# ç”Ÿäº§ç¯å¢ƒé…ç½®
FLASK_ENV=production
FLASK_DEBUG=False

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=rag_user
DB_PASSWORD=strong_password_here
DB_NAME=rag_knowledge_base

# JWTå¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
JWT_SECRET_KEY=use-a-strong-random-key-here

# æ—¥å¿—é…ç½®
LOG_LEVEL=WARNING
LOG_FILE=/home/ragapp/logs/app.log

# CORSé…ç½®
CORS_ORIGINS=https://yourdomain.com
```

### 3.4 åˆå§‹åŒ–ç”Ÿäº§æ•°æ®åº“

```bash
# åˆ›å»ºMySQLç”¨æˆ·å’Œæ•°æ®åº“
mysql -u root -p << EOF
CREATE DATABASE IF NOT EXISTS rag_knowledge_base CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'rag_user'@'localhost' IDENTIFIED BY 'strong_password_here';
GRANT ALL PRIVILEGES ON rag_knowledge_base.* TO 'rag_user'@'localhost';
FLUSH PRIVILEGES;
EOF

# åˆå§‹åŒ–æ•°æ®
python scripts/init_db.py
```

### 3.5 é…ç½®Gunicorn

åˆ›å»º `gunicorn_config.py`:

```python
"""Gunicorné…ç½®æ–‡ä»¶"""
import os

# ç»‘å®šåœ°å€
bind = "127.0.0.1:8000"

# å·¥ä½œè¿›ç¨‹æ•°
workers = 4

# å·¥ä½œçº¿ç¨‹æ•°
threads = 2

# è¶…æ—¶æ—¶é—´
timeout = 120

# è®¿é—®æ—¥å¿—
accesslog = "/home/ragapp/logs/gunicorn_access.log"
errorlog = "/home/ragapp/logs/gunicorn_error.log"
loglevel = "info"

# è¿›ç¨‹åç§°
proc_name = "rag-backend"

# Daemonæ¨¡å¼
daemon = False
```

### 3.6 é…ç½®Supervisor

åˆ›å»º `/etc/supervisor/conf.d/rag-backend.conf`:

```ini
[program:rag-backend]
command=/home/ragapp/rag-backend/backEnd/venv/bin/gunicorn -c gunicorn_config.py app:app
directory=/home/ragapp/rag-backend/backEnd
user=ragapp
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/home/ragapp/logs/supervisor.log
environment=PATH="/home/ragapp/rag-backend/backEnd/venv/bin"
```

**å¯åŠ¨Supervisor**:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start rag-backend
sudo supervisorctl status
```

### 3.7 é…ç½®Nginx

åˆ›å»º `/etc/nginx/sites-available/rag-backend`:

```nginx
server {
    listen 80;
    server_name api.yourdomain.com;
    
    # æ—¥å¿—
    access_log /var/log/nginx/rag-backend-access.log;
    error_log /var/log/nginx/rag-backend-error.log;
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://127.0.0.1:8000/health;
    }
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 100M;
}
```

**å¯ç”¨ç«™ç‚¹**:

```bash
sudo ln -s /etc/nginx/sites-available/rag-backend /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3.8 é…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# ä½¿ç”¨Let's Encrypt
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d api.yourdomain.com
```

### 3.9 é…ç½®é˜²ç«å¢™

```bash
# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## 4. æ•°æ®åº“åˆå§‹åŒ–æµç¨‹

### 4.1 å®Œæ•´æµç¨‹å›¾

```
å¼€å§‹
  â†“
æ£€æŸ¥MySQLè¿æ¥
  â†“
åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  â†“
åˆ›å»ºæ•°æ®è¡¨
  â”œâ”€ usersï¼ˆç”¨æˆ·è¡¨ï¼‰
  â”œâ”€ knowledge_basesï¼ˆçŸ¥è¯†åº“è¡¨ï¼‰
  â”œâ”€ documentsï¼ˆæ–‡æ¡£è¡¨ï¼‰
  â”œâ”€ knowledge_base_permissionsï¼ˆæƒé™è¡¨ï¼‰
  â”œâ”€ chat_sessionsï¼ˆä¼šè¯è¡¨ï¼‰
  â”œâ”€ chat_messagesï¼ˆæ¶ˆæ¯è¡¨ï¼‰
  â”œâ”€ modelsï¼ˆæ¨¡å‹è¡¨ï¼‰
  â””â”€ login_recordsï¼ˆç™»å½•è®°å½•è¡¨ï¼‰
  â†“
æ’å…¥åˆå§‹æ•°æ®
  â”œâ”€ ç®¡ç†å‘˜è´¦å·ï¼ˆadmin/admin123ï¼‰
  â”œâ”€ æµ‹è¯•ç”¨æˆ·ï¼ˆuser/user123ï¼‰
  â”œâ”€ é»˜è®¤LLMæ¨¡å‹
  â”œâ”€ é»˜è®¤Embeddingæ¨¡å‹
  â””â”€ ç¤ºä¾‹çŸ¥è¯†åº“
  â†“
éªŒè¯æ•°æ®å®Œæ•´æ€§
  â†“
å®Œæˆ
```

### 4.2 æ‰‹åŠ¨åˆå§‹åŒ–æ­¥éª¤

å¦‚æœè‡ªåŠ¨è„šæœ¬å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# 1. è¿æ¥MySQL
mysql -u root -p

# 2. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS rag_knowledge_base CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE rag_knowledge_base;

# 3. æ‰§è¡Œå»ºè¡¨è„šæœ¬
SOURCE /path/to/scripts/create_db.sql;

# 4. éªŒè¯è¡¨ç»“æ„
SHOW TABLES;
DESC users;

# 5. æ£€æŸ¥åˆå§‹æ•°æ®
SELECT * FROM users;
SELECT * FROM models;

# 6. é€€å‡º
EXIT;
```

### 4.3 æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤

**å¤‡ä»½**:

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p rag_knowledge_base > backup_$(date +%Y%m%d_%H%M%S).sql

# å¤‡ä»½å‘é‡æ•°æ®
tar -czf chroma_backup_$(date +%Y%m%d).tar.gz chroma_db/
```

**æ¢å¤**:

```bash
# æ¢å¤MySQLæ•°æ®
mysql -u root -p rag_knowledge_base < backup_20251017_120000.sql

# æ¢å¤å‘é‡æ•°æ®
tar -xzf chroma_backup_20251017.tar.gz
```

---

## 5. å¸¸è§é—®é¢˜æ’æŸ¥

### 5.1 æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Can't connect to MySQL server`

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥MySQLæœåŠ¡
sudo systemctl status mysql

# 2. å¯åŠ¨MySQL
sudo systemctl start mysql

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 3306

# 4. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 5. æµ‹è¯•è¿æ¥
mysql -u root -p -h localhost
```

### 5.2 ä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Failed building wheel for ...`

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ›´æ–°pip
pip install --upgrade pip setuptools wheel

# å®‰è£…ç¼–è¯‘å·¥å…·ï¼ˆLinuxï¼‰
sudo apt-get install python3-dev build-essential

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 5.3 ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**: `Address already in use`

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8000  # Linux/macOS
netstat -ano | findstr :8000  # Windows

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>  # Linux/macOS
taskkill /PID <PID> /F  # Windows

# æˆ–æ›´æ¢ç«¯å£
flask run --port=8001
```

### 5.4 æƒé™é—®é¢˜

**é”™è¯¯ä¿¡æ¯**: `Permission denied`

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ä¿®æ”¹ç›®å½•æƒé™
sudo chown -R ragapp:ragapp /home/ragapp/rag-backend
sudo chmod -R 755 /home/ragapp/rag-backend

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /home/ragapp/logs
chmod 755 /home/ragapp/logs
```

### 5.5 æ—¥å¿—æŸ¥çœ‹

```bash
# åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# Gunicornæ—¥å¿—
tail -f /home/ragapp/logs/gunicorn_error.log

# Supervisoræ—¥å¿—
tail -f /home/ragapp/logs/supervisor.log

# Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/rag-backend-error.log
```

---

## 6. å¯åŠ¨è„šæœ¬

### 6.1 å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬

åˆ›å»º `start_dev.sh`:

```bash
#!/bin/bash

echo "===================================="
echo " RAGçŸ¥è¯†é—®ç­”ç³»ç»Ÿ - å¼€å‘ç¯å¢ƒå¯åŠ¨"
echo "===================================="

# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
if [ ! -d "venv" ]; then
    echo "é”™è¯¯: è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ python3 -m venv venv"
    exit 1
fi

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ£€æŸ¥.envæ–‡ä»¶
if [ ! -f ".env" ]; then
    echo "è­¦å‘Š: .envæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä»env.exampleå¤åˆ¶..."
    cp env.example .env
    echo "è¯·ç¼–è¾‘.envæ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥"
    exit 1
fi

# è®¾ç½®ç¯å¢ƒå˜é‡
export FLASK_APP=app.py
export FLASK_ENV=development

# å¯åŠ¨æœåŠ¡
echo "æ­£åœ¨å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
echo "è®¿é—®åœ°å€: http://localhost:8000"
echo "å¥åº·æ£€æŸ¥: http://localhost:8000/health"
echo "æŒ‰ Ctrl+C åœæ­¢æœåŠ¡"
echo ""

python app.py
```

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start_dev.sh

# å¯åŠ¨
./start_dev.sh
```

### 6.2 ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬

åˆ›å»º `start_prod.sh`:

```bash
#!/bin/bash

echo "===================================="
echo " RAGçŸ¥è¯†é—®ç­”ç³»ç»Ÿ - ç”Ÿäº§ç¯å¢ƒå¯åŠ¨"
echo "===================================="

# æ£€æŸ¥ç”¨æˆ·
if [ "$USER" != "ragapp" ]; then
    echo "è­¦å‘Š: å»ºè®®ä½¿ç”¨ragappç”¨æˆ·è¿è¡Œ"
fi

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /home/ragapp/rag-backend/backEnd/venv/bin/activate

# æ£€æŸ¥é…ç½®
if [ ! -f ".env" ]; then
    echo "é”™è¯¯: .envæ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
fi

# å¯åŠ¨Supervisor
sudo supervisorctl start rag-backend
sleep 2

# æ£€æŸ¥çŠ¶æ€
STATUS=$(sudo supervisorctl status rag-backend | awk '{print $2}')

if [ "$STATUS" == "RUNNING" ]; then
    echo "âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ"
    echo "è®¿é—®åœ°å€: http://your-server-ip:8000"
    sudo supervisorctl status rag-backend
else
    echo "âŒ æœåŠ¡å¯åŠ¨å¤±è´¥"
    echo "æŸ¥çœ‹æ—¥å¿—: tail -f /home/ragapp/logs/supervisor.log"
    exit 1
fi
```

### 6.3 åœæ­¢è„šæœ¬

åˆ›å»º `stop.sh`:

```bash
#!/bin/bash

echo "åœæ­¢RAGåç«¯æœåŠ¡..."

# å¼€å‘ç¯å¢ƒï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢Pythonè¿›ç¨‹
pkill -f "python app.py"

# ç”Ÿäº§ç¯å¢ƒï¼šåœæ­¢Supervisorç®¡ç†çš„æœåŠ¡
if command -v supervisorctl &> /dev/null; then
    sudo supervisorctl stop rag-backend
fi

echo "æœåŠ¡å·²åœæ­¢"
```

### 6.4 é‡å¯è„šæœ¬

åˆ›å»º `restart.sh`:

```bash
#!/bin/bash

echo "é‡å¯RAGåç«¯æœåŠ¡..."

# ç”Ÿäº§ç¯å¢ƒ
if command -v supervisorctl &> /dev/null; then
    sudo supervisorctl restart rag-backend
    sleep 2
    sudo supervisorctl status rag-backend
else
    # å¼€å‘ç¯å¢ƒ
    ./stop.sh
    sleep 1
    ./start_dev.sh
fi
```

### 6.5 å¥åº·æ£€æŸ¥è„šæœ¬

åˆ›å»º `health_check.sh`:

```bash
#!/bin/bash

echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."

# æ£€æŸ¥APIå“åº”
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8000/health)

if [ "$RESPONSE" -eq 200 ]; then
    echo "âœ… æœåŠ¡æ­£å¸¸è¿è¡Œ"
    curl -s http://localhost:8000/health | python3 -m json.tool
    exit 0
else
    echo "âŒ æœåŠ¡å¼‚å¸¸ (HTTP $RESPONSE)"
    exit 1
fi
```

---

## 7. ç›‘æ§å’Œç»´æŠ¤

### 7.1 æ—¥å¿—è½®è½¬

åˆ›å»º `/etc/logrotate.d/rag-backend`:

```
/home/ragapp/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 ragapp ragapp
    sharedscripts
    postrotate
        sudo supervisorctl restart rag-backend
    endscript
}
```

### 7.2 å®šæ—¶ä»»åŠ¡

ç¼–è¾‘crontabï¼š

```bash
crontab -e
```

æ·»åŠ ï¼š

```cron
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * /home/ragapp/scripts/backup.sh

# æ¯å°æ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€
0 * * * * /home/ragapp/rag-backend/backEnd/health_check.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†æ—§æ—¥å¿—
0 3 * * 0 find /home/ragapp/logs -name "*.log.*" -mtime +30 -delete
```

### 7.3 æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹èµ„æºå ç”¨
ps aux | grep gunicorn

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# å®æ—¶ç›‘æ§
htop
```

---

## 8. æ›´æ–°éƒ¨ç½²

```bash
# 1. å¤‡ä»½æ•°æ®
./scripts/backup.sh

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. æ›´æ–°ä¾èµ–
source venv/bin/activate
pip install -r requirements.txt

# 4. åº”ç”¨æ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœ‰ï¼‰
flask db upgrade

# 5. é‡å¯æœåŠ¡
sudo supervisorctl restart rag-backend

# 6. éªŒè¯
./health_check.sh
```

---

## 9. å›æ»šæ“ä½œ

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼š

```bash
# 1. åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
git checkout <previous-commit-hash>

# 2. æ¢å¤æ•°æ®åº“
mysql -u root -p rag_knowledge_base < backup_latest.sql

# 3. é‡å¯æœåŠ¡
sudo supervisorctl restart rag-backend
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜è¯·æŸ¥çœ‹ï¼š
- åº”ç”¨æ—¥å¿—: `logs/app.log`
- é”™è¯¯æ—¥å¿—: `/home/ragapp/logs/gunicorn_error.log`
- ç³»ç»Ÿæ—¥å¿—: `/var/log/syslog`

**è”ç³»æ–¹å¼**: support@example.com

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

